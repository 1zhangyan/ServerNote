# 从单体结构开始  
> [MonolithFirst原文链接](https://martinfowler.com/bliki/MonolithFirst.html)  

总结我所知的使用微服务架构的团队，他们的开发过程都有个通用模式。
- 1.几乎所有的成功的微服务都开始于一个需要分割的庞然大物。
- 2.几乎所有的从草图阶段就准备使用微服务的系统，都遇到了严重的问题而不得已终止。  
这种情况使得我的许多同事认为，***即使很确定自己的项目会变得很大，大到微服务架构可以发挥价值，也不能在项目一开始就使用微服务。***   

微服务是一个很实用的架构，但是即便是它的倡导者也认为使用微服务会带来额外的问题，这意味着微服务只在更复杂的系统中有用。微服务引入的额外问题，本质上是管理很多服务带来的开销，这种开销会拖累团队，也让单体架构的优势凸显。这给从单体结构开始的策略得到了有力的支持。所以，在构建一个新应用的时候，最好采用单体结构，即使你认为似乎以后使用微服务会带来更多好处。  

从单体结构开始的第一个原因是极限编程中经典原则“Yagni”。当你开始一个新应用时，你有多确定它对用户是有用的？扩展一个设计糟糕但是获得成功的软件系统可能很难，但是总比反过来扩展设计的很好但是不成功的软件要好。我们知道，评级一个软件创意的最好方式是做出来一个简单版本，然后观察它运行起来到底怎么样。在整个的第一阶段，速度应该被放在第一优先级（以此快速反馈形成迭代循环），而微服务会成为拖慢你速度的因素。  

第二个原因是从微服务开始会带来严重的问题。微服务只在你能设定良好且固定的服务边界时发挥良性作用，这个本质上是划分正确的限界上下文的问题。服务之间的任何功能性重构在微服务架构中都比在单体架构中难的多。但是即便是经验丰富的架构师在熟悉的领域，也很难在软件设计伊始就正确划分服务边界。在使用微服务之前构建一个单体架构可以帮助你确定服务之间的正确边界。同时它也让你有时间开发微服务[必需条件](https://martinfowler.com/bliki/MicroservicePrerequisites.html)，这些必需条件是你在做细粒度划分服务的时候需要的。  

我听过不同践行单体先行策略的不同方式，符合逻辑的方式应该是这样：先谨慎构建单体结构，关注点放在模块化软件，API边界和数据存储都很重要。这点做好了，后续转向微服务也会简单些。但是这么做的团队并不是很多。  

一个更加常见的做法是从单体开始，逐渐在边缘剥落微服务。这种方式会在微服务架构中心留下一个牢不可分的单体结构，但是所有的新的开发都发生在微服务中，中心的单体接结构变动不大。  

另一个常见的方法是完全替代单体架构。几乎没有人认为这是一种值得骄傲的方式，但是把单体架构献祭也有自己的优势。不要害怕献祭单体架构，尤其在单体可以让软件快速接近市场。  

我还遇到的另一条路是先划分比你预期要粗粒度的服务。使用这些粗粒度的服务去熟悉多个服务。这也带来了一个好处，这种方式会减少需要重构的内部服务的数量。随着边界的稳定，在去划分更细粒度的服务。   

虽然我了解的朋友们大都倾向于单体先行的策略，但也不是所有人都这么认为。相反的观点认为，从微服务开始可以让你熟悉微服务环境的节奏。以充分模块化的方式构建单体结构可能会很花时间，不如将其拆分成微服务来的简单。从微服务开始让每个人一开始就熟悉在分散的小团队做开发。而且将团队按照服务边界划分开也让衡量开发工作量变得简单。在系统替换的时候这种方式尤其可性，这时你有更好的机会早点界定足够稳定的边界。虽然论据很少，但是我认为你不应该微服务先行，除非你有足够合理的构造微服务系统的经验。  

我觉得我没有足够的证据来做个铁论决定是否应该单体先行。现在还是微服务的早期，没有足够的案例去汲取教训。故而任何人在此话题下的意见都必然被视为尝试性的而非确定性的论据。